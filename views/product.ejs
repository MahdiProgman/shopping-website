<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      ูุฏููู ุจููุชูุซ ฺฉุฑููุง ุจุง ูฺฉุฑูููู (ูพุฎุด ุชุง 16 ุณุงุนุชุ ุฑู ฺฏูุดุ ูุดฺฉ)
    </title>
    <link rel="icon" type="image/x-icon" href="/assets/icons/brand.png" />
    <link rel="stylesheet" href="/libs/swiper/swiper-bundle.min.css" />
    <link rel="stylesheet" href="/styles/global.css" />
    <link rel="stylesheet" href="/styles/product.css" />
    <link rel="stylesheet" href="/libs/sweetalert2/sweetalert2.min.css" />
    <link rel="stylesheet" href="/libs/notyf/notyf.min.css">
  </head>
  <body>
    <div class="overlay <%= !isCommentBoxOpen ? 'hidden' : '' %>"></div>
    <%- include("includes/drawer", { page: 'product' }) %>
    <div class="submit-comment-box  <%= isCommentBoxOpen ? 'on' : '' %>">
      <div class="box">
        <div class="header">
          <h5>ุซุจุช ูุธุฑ</h5>
          <button class="close-box">
            <img src="/assets/icons/close.svg" alt="" />
          </button>
        </div>
        <form action="/<%= product.product_code %>/add/comment" method="post">
          <div class="main">
            <label for="comment-text">ูุธุฑ ุดูุง</label>
            <textarea
              name="comment_text"
              id="comment-text"
              rows="10"
              placeholder="ูุธุฑ ุฎูุฏ ุฑุง ุจููุณุฏ..."
            ><%= oldData ? oldData.comment_text : '' %></textarea>
            <% if(errors) { %>
              <ul>
                <% errors.forEach(error => { %>
                  <% if(error.field == 'comment_text') { %>
                    <li><%= error.error %></li>
                  <% } %>
                <% }); %>
              </ul>
            <% } %>
            <label>ุงูุชุงุฒ</label>
            <%
              const rateTexts = {
                '5': '๐ ุนุงู (ต ุงุฒ ต ุงูุชุงุฒ)',
                '4': '๐ ุฎูุจ (ด ุงุฒ ต ุงูุชุงุฒ)',
                '3': '๐ ูุนููู (ณ ุงุฒ ต ุงูุชุงุฒ)',
                '2': 'โน๏ธ ุถุนู (ฒ ุงุฒ ต ุงูุชุงุฒ)',
                '1': '๐ ุจุฏ (ฑ ุงุฒ ต ุงูุชุงุฒ)'
              };

              const selectedRate = oldData ? oldData.rate : '5';
            %>
            <div class="custom-select">
              <input class="custom-select-input" id="rate" name="rate" type="hidden" value="<%= oldData ? oldData.rate : 5 %>">
              <div class="select-box">
                <span><%= rateTexts[selectedRate] %></span>               
                <img src="/assets/icons/caret.svg" alt="">
              </div>
              <div class="dropdown">
                <ul>
                  <li data-value="5" class="<%= selectedRate == '5' ? 'selected' : 'selected' %>">
                    <span>๐ ุนุงู (ต ุงุฒ ต ุงูุชุงุฒ)</span>
                  </li>
                  <li data-value="4" class="<%= selectedRate == '4' ? 'selected' : '' %>">
                    <span>๐ ุฎูุจ (ด ุงุฒ ต ุงูุชุงุฒ)</span>
                  </li>
                  <li data-value="3" class="<%= selectedRate == '3' ? 'selected' : '' %>">
                    <span>๐ ูุนููู (ณ ุงุฒ ต ุงูุชุงุฒ)</span>
                  </li>
                  <li data-value="2" class="<%= selectedRate == '2' ? 'selected' : '' %>">
                    <span>โน๏ธ ุถุนู (ฒ ุงุฒ ต ุงูุชุงุฒ)</span>
                  </li>
                  <li data-value="1" class="<%= selectedRate == '1' ? 'selected' : '' %>">
                    <span>๐ ุจุฏ (ฑ ุงุฒ ต ุงูุชุงุฒ)</span>
                  </li>
                </ul>
              </div>
            </div>
            <label for="positive-points">ูฺฉุงุช ูุซุจุช</label>
            <div class="positive-points">
              <div class="input">
                <input
                  type="text"
                  id="positive-points"
                  placeholder="ูฺฉุชู ูุซุจุช ุฎูุฏ ุฑุง ุจููุณุฏ..."
                />
                <button type="button">ุซุจุช</button>
              </div>
              <ul>
                <% if (oldData && oldData.positive_points && oldData.positive_points.length !== 0) { %>
                  <% for(let positivePoint of oldData.positive_points) { %>
                    <li>
                      <div class="text">
                        <img src="/assets/icons/plus.svg" />
                        <span><%= positivePoint %></span>
                        <input type="hidden" name="positive_points[]" required value="<%= positivePoint %>" />
                      </div>
                      <button type="button" class="delete-btn">
                        <img src="/assets/icons/trash.svg" />
                      </button>
                    </li>
                  <% }; %>
                <% } %>
              </ul>
            </div>
            <label for="negetive-points">ูฺฉุงุช ููู</label>
            <div class="negetive-points">
              <div class="input">
                <input
                  type="text"
                  id="negetive-points"
                  placeholder="ูฺฉุชู ููู ุฎูุฏ ุฑุง ุจููุณุฏ..."
                />
                <button type="button">ุซุจุช</button>
              </div>
              <ul>
                <% if (oldData && oldData.negetive_points && oldData.negetive_points.length !== 0) { %>
                  <% for(let negetivePoint of oldData.negetive_points) { %>
                    <li>
                      <div class="text">
                        <img src="/assets/icons/plus.svg" />
                        <span><%= negetivePoint %></span>
                        <input type="hidden" name="negetive_points[]" required value="<%= negetivePoint %>" />
                      </div>
                      <button type="button" class="delete-btn">
                        <img src="/assets/icons/trash.svg" />
                      </button>
                    </li>
                  <% }; %>
                <% } %>
              </ul>
            </div>
            <button type="submit">ุซุจุช ูุธุฑ</button>
          </div>
        </form>
      </div>
    </div>
    <div class="image-viewer">
      <img src="/assets/images/croma.png" alt="" />
      <button class="close-image-btn">ุจุณุชู</button>
    </div>
    <div class="main">
      <%- include("includes/header", { page: 'product' }) %>
      <div class="header-overlay hidden"></div>
      <main>
        <section class="product-section">
          <div class="images">
            <div class="main-image">
              <img src="<%= product.image %>" alt="" />
            </div>
            <% if(product.images.length !== 0) { %>
            <div class="images-list">
              <% product.images.map(image => {%>
              <button class="image-btn">
                <img src="<%= image %>" alt="" />
              </button>
              <% }); %>
            </div>
            <% } %>
          </div>
          <div class="details">
            <div class="category">
              <span>ุฏุฑ ุฏุณุชู ุจูุฏ : </span>
              <a
                class="special"
                href="/products?category=<%= product.category %>"
                ><%= product.category_fa %></a
              >
            </div>
            <h1><%= product.title %></h1>
            <div class="rate">
              <img src="/assets/icons/star.png" alt="" />
              <span class="rate-number"
                ><%= toPersianDigitsHelper(product.rate) %></span
              >
            </div>
            <div class="number-of-views number">
              <img src="/assets/icons/eye.svg" alt="" />
              <span><%= toPersianDigitsHelper(product.views) %></span>
            </div>
            <div class="number-of-comments number">
              <img src="/assets/icons/message.svg" alt="" />
              <span
                ><%= toPersianDigitsHelper(product.comments ?
                product.comments.length : 0) %></span
              >
            </div>
            <div class="price">
              <h4><%= product.price_fa %> ุชููุงู</h4>
            </div>
            <div class="buttons">
              <% if(!isProductInFavorites) { %>
                <form action="/favorites/add/<%= product.product_code %>" method="post">
                  <button class="favorite">
                    <img src="/assets/icons/heart.svg" alt="" />
                    <span>ุงูุฒูุฏู ุจู ุนูุงูู ููุฏ ูุง</span>
                  </button>
                </form>
              <% } else { %>
                <form action="/favorites/delete/<%= product.product_code %>" method="post">
                  <button class="favorite added">
                    <img src="/assets/icons/heart.svg" alt="" />
                    <span>ุญุฐู ุงุฒ ุนูุงูู ููุฏ ูุง</span>
                  </button>
                </form>
              <% } %>
              <% if(!isProductInCart) { %>
                <form action="/cart/add/<%= product.product_code %>" method="post">
                  <button class="cart">
                    <img src="/assets/icons/cart.svg" alt="" />
                    <span>ุงูุฒูุฏู ุจู ุณุจุฏ ุฎุฑุฏ</span>
                  </button>
                </form>
              <% } else { %>
                <form action="/cart/delete/<%= product.product_code %>" method="post">
                  <button class="cart added">
                    <img src="/assets/icons/cart.svg" alt="" />
                    <span>ุญุฐู ุงุฒ ุณุจุฏ ุฎุฑุฏ</span>
                  </button>
                </form>
              <% } %>
            </div>
          </div>
        </section>
        <section class="description-and-specifications">
          <div class="description">
            <h5>ุชูุถุญุงุช</h5>
            <p><%= product.description %></p>
            <button class="show-more-btn">
              <span>ูุดุงูุฏู ุจุดุชุฑ</span>
              <img src="/assets/icons/caret.svg" alt="" />
            </button>
          </div>
          <div class="specifications">
            <h5>ูุดุฎุตุงุช</h5>
            <div class="specification-rows">
              <% product.specifications.map(specification => { %>
              <div class="specification-row">
                <span class="property"><%= specification.name %></span>
                <span class="value"><%= specification.value %></span>
              </div>
              <% }); %>
            </div>
          </div>
        </section>
        <section class="comments-section">
          <div class="rate-and-submit-comment">
            <div class="rate">
              <img src="/assets/icons/star.png" alt="" />
              <span class="rate-number"><%= toPersianDigitsHelper(product.rate) %></span>
            </div>
            <span class="comments-number">ุงุฒ ูุฌููุน <%= toPersianDigitsHelper(product.comments ? product.comments.length : 0) %> ูุธุฑ</span>
            <p>ุดูุง ูู ูุธุฑ ุฎูุฏ ุฑุง ุซุจุช ฺฉูุฏ!</p>
            <button class="write-comment-btn" id="write-comment-btn">ููุดุชู ูุธุฑ</button>
          </div>
          <div class="comments">
            <h5>ูุธุฑุงุช</h5>
            <% if(product.comments) { %>
              <div class="comments-list">
                <% product.comments.map(comment => { %>
                  <div class="comment">
                    <div class="name">
                      <img src="/assets/icons/person.svg" alt="" />
                      <h6><%= comment.user.first_name + ' ' + comment.user.last_name %></h6>
                    </div>
                    <div class="rate">
                      <img src="/assets/icons/star.png" alt="" />
                      <span class="rate-number"><%= toPersianDigitsHelper(comment.rate) %></span>
                    </div>
                    <p class="comment-text">
                      <%= comment.commentText %>
                    </p>
                    <ul class="positive-points">
                      <% if(comment.positivePoints.length !== 0) { %>
                        <% comment.positivePoints.map(positivePoint => { %>
                          <li>
                            <img src="/assets/icons/plus.svg" alt="" />
                            <span><%= positivePoint %></span>
                          </li>
                        <% }); %>
                      <% } %>
                    </ul>
                    <ul class="negetive-points">
                      <% if(comment.negetivePoints.lenght !== 0) { %>
                        <% comment.negetivePoints.map(negetivePoint => { %>
                          <li>
                            <img src="/assets/icons/minus.svg" alt="" />
                            <span><%= negetivePoint %></span>
                          </li>
                        <% }); %>
                      <% } %>
                    </ul>
                  </div>
                <% }); %>
              </div>
            <% } else { %>
              <div class="no-data">
                <img src="/assets/icons/no-data.png" alt="">
                <span>ุชุง ุงูุงู ูุธุฑ ุจุฑุง ุงู ูุญุตูู ุซุจุช ูุดุฏู.</span>
              </div>
            <% } %>
          </div>
        </section>
        <section class="best-selling-products-in-this-category">
          <h4>ฺฉุงูุง ูุง ูพุฑูุฑูุด ุฏุฑ ุงู ุฏุณุชู ุจูุฏ</h4>
          <%- include("includes/products-list", { products:
          productsInThisCategory }) %>
        </section>
      </main>
      <%- include("includes/footer") %>
    </div>
    <script>
      let login_state = JSON.parse("<%= login_state %>");
      let newCommentSubmitted = JSON.parse("<%= newCommentSubmitted %>");
      let isUserCommentedBefore = JSON.parse("<%= isUserCommentedBefore %>");
      let cartAction = "<%= cartAction %>";
      let favoritesAction = "<%= favoritesAction %>";
    </script>
    <script src="/libs/notyf/notyf.min.js"></script>
    <script src="/libs/sweetalert2/sweetalert2.all.min.js"></script>
    <script src="/libs/swiper/swiper-bundle.min.js"></script>
    <script src="/scripts/global.js"></script>
    <script src="/scripts/product.js"></script>
    <script>
      if('<%= error %>') notyf.error('<%= error %>');
    </script>
  </body>
</html>
